---
- name: Add PPA
  apt_repository:
    repo: "{{ item }}"
    state: present
    update_cache: no
  with_items: "{{ desktop.ppas }}"
  when: desktop.ppas
  become: true

- name: Add PPA repo keys
  apt_key:
    url: "{{ item }}"
    state: present
  with_items: "{{ desktop.ppa_keys }}"
  when: desktop.ppa_keys
  become: true

- name: Run update
  apt:
    update_cache: true
  become: true

- name: Install desktop packages
  apt:
    name: "{{ desktop.pkgs }}"
    state: latest
  become: true

- name: Install snap packages
  snap:
    name: "{{ desktop.snap_pkgs }}"
    classic: true
  become: true

- name: Create directories
  file:
    name: "{{lookup('env','HOME')}}/project"
    state: directory

- name: Cloning repo
  git:
    repo: "{{ item.value }}"
    dest: "{{lookup('env','HOME')}}/projects/{{ item.key }}"
    force: true
  loop: "{{ lookup('dict', git_projects, wantlist=True) }}"

- name: Change ubuntu gnome app icon location
  shell: "gsettings set org.gnome.shell.extensions.dash-to-dock show-apps-at-top true"
  ignore_errors: true
  when:  ansible_facts["distribution"] == "Ubuntu"
